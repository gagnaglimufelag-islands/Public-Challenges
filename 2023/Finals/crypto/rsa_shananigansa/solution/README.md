# RSA Shananigansa

In this problem we get two files `chall.py`
```python
from Crypto.Util.number import getPrime, bytes_to_long, long_to_bytes
import time
import random
random.seed(133337)

p = getPrime(1024)
q = getPrime(1024)
e = 0x10001

with open('flag.txt', 'rb') as f:
    flag = bytes_to_long(f.read())


n = p*q

print(n)

p_bin = bin(p)[2:].zfill(1024)
out_p = ''
c = 0
for b in p_bin:
    if not random.randint(0, 1):
        c += 1
        out_p += '?'
    else:
        out_p += b
print(out_p)

q_bin = bin(q)[2:].zfill(1024)
out_q = ''
for b in q_bin:
    if not random.randint(0, 1):
        c += 1
        out_q += '?'
    else:
        out_q += b
print(out_q)

print(long_to_bytes(pow(flag, e, n)).hex())
```

and `out.txt`
```python
22457391002825748083672894359744219507243385590088569032059019221947050859285875623803874937465486265296026385644800775979496390513453570399459353470686948230678796150458944688760507604666485094024227504971270076971867785723663908152878240291190888544040628026078517220402611619188766133427980077904171527013894747423833669491357679004159578537553891384434556993164426764635597845000376030482370308816255144412624981588321773585995788452734697725590559426688836285908686387336294129705278848185717930220922641694264692183523663667185775859026650941919684191711016787304624341539502885566814915385727556768217043925679
1111?010010?0001??100?1?1??1?01?1?11111010?000?0?1?01?1?101??010?1??00??10??10???0?????1?10?1???1000?101?01?????1101??0??11?11?1?0?1?10?0?0???0?1?00????0100????1110??110????1?10??00100000??1???1??????11111?10??0???0?00?0?001?1?00?0????0?0?00?1?10?0??00?0??00??1?01?101??????111000???100?1?001001?1???010???101??00001??11?0????1?0??1?0?100?0?0???1010???1?11?1??0??001?0?0??????01??011???0???111??1?1?011?10010????1??11?1?0??1?0?01?001?01101?1????0010?1??1????1????10?1???000??????1?????0?0?0011?11?011?1???0?1?0??10?1?1011?010?1????10?0????1100?00???0??1?10101???1?0?1101?11?0??1????0??1?0??0?????1???1??0?1000?0????00??0010??0?0101??0?1?1101?0?0?10?00????01??110??1?00??0??10011????1??011??11?0?100010???1?11?1?0?????00?1??1?11010??1111????01?1????0??00???????010?0110??0??010?00??????11011?010110010?11????11?1?0?1?0??00011101101100010?11????11????0?01100?1?1??10??10?00????10?001???101010?????00?1?1?0?0?110?10?0??1???00??1???10??001?0???0?1?0110?0??1??1???1???00???1??0??0?0?????0??10??0?????11?1?0?0?10?000???011?1?10??1
????01???1?0?????1??100?0?1?????0111111000???0?0?1?111??11??1??001?110101?0?1???00??11????0?1??0??01???????00?????1????011???????110?0??1011???0?0?1???1??0???01?1011????0????????110??01??001??01??1?0??1?1100111?011?1?1?01011????1?1?1???01?1????1?011???11???1???01???0??1110?1??1?100?00?0?0?0?0???1?1?111???01111?0?1??1?11?0???010???1?01?10??11?11???10???010?1?101?110???0?1101??10???011?1?1??0?0??10101?01??011?????0???110?011?01???111?110??????10?0??01?00????00?0???11111100?10?000???110???0?0????11?1?1?000?1111101?10??0?01?10??1???1?1?0?1?1001??11?0?1?0???110??1101??1?0?1?0010??1?1?100101?1???01??10????10???1??01110??????0?010?1???00?00?0??????1?10?1?1??0?1?1???1010?1001????0?0?0??10??0?011?00???1???111?1???10?0???010?010??10??0???01?0?01?11??0?1????10?1?0?0??011???1??1010??100010?0110?01?00??010??0????0??1?01?0??????1?10?01?1??0??0?11??110??0?1111?111110?100???0?0?000??00100??????0??101??10???111000??????111??00???101??0???1?100???00?1?001????0?1011?????0?010????1?011?1??01?1???10??10?0?10????1100?0?0??1?0????1
aaa176055840fbe7810475355893e22540f126cd9f26c353baf5d893e7e0438291d63ca8b9640ea66959dbb236ba8c72a44dddc8a7b34104dd1c3b5949b9502ac355114aeed1d706afdc3a67580a399b15ecb406939d6c5139f0223daa810e3e25789ebd455d7316e9a12e1901312cadf8e15449e383f932e4c60aec510ea68f3631a596bfb4730cf7a99af04f9df48e668a51a45b28dba873beb3a9d78aa4803c84d68507c32368b75f053ab0c5f2cf4a0dd7fb056edbfe8071b66f499065351393c36b3ee6f0ef3ba5491c3fd34fce18f25e014676b671ebaf1fb9dce9ff57056509f1a0b18a49440e7eb08dc2ce90bf3a154b775e39c435a4a69be7d17cbe
```

as we can see, this is a standard RSA decryption problem were we are missing some bits in p and q. Looking around online we might stumble upon `https://github.com/y011d4/factor-from-random-known-bits` which solves this problem for us.

So after installing that we just find the factors and dectrypt the flag
```python
import factor

with open("out.txt", "r") as f:
        out = f.read()

n = int(out.split('\n')[0])
e = 0x10001

p_out = out.split('\n')[1].replace('?','_')
q_out = out.split('\n')[2].replace('?','_')

enc = int(out.split('\n')[3],16)

p,q = factor.from_str(n, p_out, q_out)
assert p*q == n

phi = (p-1)*(q-1)
d = pow(e, -1 , phi)
flag = bytes.fromhex(hex(pow(enc, d, n))[2:]).decode()

print(flag)
```
flag: `gg{RsA_h4s_4l0t_0F_S4n4n1g4nsa!}`
